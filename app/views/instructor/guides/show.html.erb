<script>

  $(function() {
    $('.lessons').sortable({
      update: function( event, ui ) {
       $.ajax({
        type: 'PUT',
        url: ui.item.data('update-url'),
        dataType: 'json',
        data: { lesson: { row_order_position: ui.item.index() } }
       });
      }
    });
  });

  $(function() {
    $('.sections').sortable({
      update: function( event, ui ) {
       $.ajax({
        type: 'PUT',
        url: ui.item.data('update-url'),
        dataType: 'json',
        data: { section: { row_order_position: ui.item.index() } }
       });
      }
    });
  });


</script>


<%= link_to 'Preview as Student', guide_path(current_guide), class: 'btn btn-warning btn-lg stdnt-btn' %>
<br />
<div class="new-box mx-auto text-center">
	<h1><%= current_guide.title %></h1>
  <% if current_guide.image.present? %>
    <%= image_tag current_guide.image.url, class: 'img-fluid' %>
  <% end %>
	<h4><%= current_guide.description %></h4>
 
</div> 


<ul class='sections'>
  <% current_guide.sections.rank(:row_order).each do |section| %>

  
    <li data-update-url="<%= instructor_section_path(section) %>" class="section-li mx-auto text-center">
            
      <div class="header">
        <span class="fa fa-ellipsis-v"></span><%= section.title %>
      </div>

      <ul class='lessons'> 
        <% section.lessons.rank(:row_order).each_with_index do |lesson, position| %>
        
          <li data-update-url="<%= instructor_lesson_path(lesson) %>">

            <div class="float-left">
              <span class="fa fa-ellipsis-v"></span>
            </div>

            <p>
              <b>Lesson <%= position+1 %>: <%= lesson.title %></b>
            </p>
            <hr>
            <p>
              <%= lesson.subtitle %>
            </p>
          </li>
        
        <% end %>
      </ul>
      <br />
      <%= link_to "New Lesson", new_instructor_section_lesson_path(section), class: 'btn btn-primary mx-auto' %>
    </li>
  <% end %>
 </ul> 
<br />

<div class="text-center">
  <%= link_to "Add a new section", new_instructor_guide_section_path(current_guide), class: 'btn btn-primary btn-lg' %>

</div>